<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skills - Juan Diego Cueva</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- WebGazer -->
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
  <!-- Heatmap.js -->
  <script src="https://cdn.jsdelivr.net/npm/heatmapjs@2.0.2/heatmap.min.js"></script>
  <style>
    #heatmapContainer {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 9999;
      width: 100%;
      height: 100%;
      pointer-events: none;
      display: none;
    }

    #stopTrackingBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 10000;
      background-color: #dc3545;
      color: #fff;
      border: none;
      padding: 0.8rem 1.2rem;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    #stopTrackingBtn:hover {
      background-color: #c82333;
    }
  </style>
</head>

<body>
  <div id="heatmapContainer"></div>
  <button id="stopTrackingBtn">Detener Seguimiento</button>

  <header>
    <nav class="navbar">
      <div class="navbar-logo">
        <h1>Juan Diego Cueva</h1>
        <p>Desarrollador de Software</p>
      </div>
      <ul class="navbar-menu">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="acerca.html">Acerca de Mí</a></li>
        <li><a href="contacto.html">Contáctame</a></li>
        <li><a href="proyectos.html">Proyectos</a></li>
        <li><a href="skills.html" class="active">Skills</a></li>
      </ul>
    </nav>
  </header>

  <main class="main-content">
    <section class="skills-section" tabindex="0">
      <h2>Mis Habilidades Técnicas</h2>
      <div class="skills-grid">
        <article class="skill-card">
          <h3>Front-End</h3>
          <ul>
            <li>HTML5, CSS3, JavaScript</li>
            <li>Bootstrap 5, Tailwind CSS</li>
            <li>React.js y consumo de APIs REST</li>
          </ul>
        </article>

        <article class="skill-card">
          <h3>Back-End</h3>
          <ul>
            <li>Node.js, Express</li>
            <li>PHP con Laravel</li>
            <li>Controladores, rutas, autenticación</li>
          </ul>
        </article>

        <article class="skill-card">
          <h3>Base de Datos</h3>
          <ul>
            <li>MySQL y PostgreSQL</li>
            <li>MongoDB (básico)</li>
            <li>ORM: Eloquent y Sequelize</li>
          </ul>
        </article>

        <article class="skill-card">
          <h3>Otras Competencias</h3>
          <ul>
            <li>Metodologías ágiles (Scrum)</li>
            <li>Git y GitHub</li>
            <li>Diseño UX/UI y prototipado</li>
          </ul>
        </article>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 Juan Diego Cueva | Desarrollador de Software</p>
      <nav aria-label="Mapa del sitio">
        <ul class="footer-nav">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="acerca.html">Acerca de Mí</a></li>
          <li><a href="contacto.html">Contáctame</a></li>
          <li><a href="proyectos.html">Proyectos</a></li>
          <li><a href="skills.html">Skills</a></li>
        </ul>
      </nav>
    </div>
  </footer>

<script>
  const heatmapContainer = document.getElementById("heatmapContainer");

  const heatmapInstance = h337.create({
    container: heatmapContainer,
    radius: 60,
    maxOpacity: 0.7,
    minOpacity: 0.2,
    blur: 0.85
  });

  const gazeData = [];

  window.onload = async function () {
    await webgazer.setGazeListener(function (data, elapsedTime) {
      if (data) {
        const x = Math.round(data.x);
        const y = Math.round(data.y);
        if (x > 0 && y > 0) {
          gazeData.push({ x: x, y: y, value: 1 });
        }
      }
    }).begin();

    webgazer
      .showVideoPreview(false)
      .showPredictionPoints(true)
      .showFaceOverlay(false)
      .showFaceFeedbackBox(false);
  };

  document.getElementById("stopTrackingBtn").addEventListener("click", function () {
    webgazer.end();

    if (gazeData.length === 0) {
      alert("No se recolectaron datos suficientes para generar el mapa de calor.");
      return;
    }

    // Forzar visibilidad del contenedor
    heatmapContainer.style.width = window.innerWidth + "px";
    heatmapContainer.style.height = window.innerHeight + "px";
    heatmapContainer.style.display = "block";

    // Forzar limpieza previa
    heatmapInstance.setData({ max: 0, data: [] });

    // Pintar mapa con nuevos datos
    heatmapInstance.setData({
      max: 10,
      data: gazeData
    });

    // Forzar repintado luego de un retraso
    setTimeout(() => {
      heatmapInstance.repaint();
    }, 200);

    console.log("Seguimiento detenido. Datos recolectados:", gazeData);

    this.disabled = true;
    this.textContent = "Seguimiento detenido";
  });
</script>

</body>

</html>
